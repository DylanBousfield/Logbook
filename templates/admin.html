{% extends 'base.html' %}
{% block content %}
  <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
    <div class="flex items-center justify-between gap-4 flex-wrap">
      <h1 class="text-xl font-semibold">Admin â€” Work Logs</h1>
      <a id="exportBtn" href="#" class="px-4 py-2 rounded-xl bg-slate-900 text-white hover:opacity-90">Export to Excel</a>
    </div>

    <form id="filters" class="mt-4 grid md:grid-cols-4 gap-3">
      <input type="text" name="name" value="{{ request.args.get('name','') }}" placeholder="Filter by name" class="rounded-xl border-slate-300 focus:border-primary focus:ring-primary" />
      <input type="date" name="start" value="{{ request.args.get('start','') }}" class="rounded-xl border-slate-300 focus:border-primary focus:ring-primary" />
      <input type="date" name="end" value="{{ request.args.get('end','') }}" class="rounded-xl border-slate-300 focus:border-primary focus:ring-primary" />
      <button class="rounded-xl bg-primary text-white px-3 py-2">Apply Filters</button>
    </form>

    {% if names %}
      <div class="mt-3 text-sm flex flex-wrap gap-2">
        {% for n in names %}
          <a href="{{ url_for('admin') }}?name={{ n }}" class="px-2.5 py-1 rounded-full border border-slate-300 hover:border-primary">{{ n }}</a>
        {% endfor %}
      </div>
    {% endif %}

    <div class="mt-6 overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left border-b">
            <th class="py-2 pr-4">Name</th>
            <th class="py-2 pr-4">Date</th>
            <th class="py-2 pr-4">Hours</th>
            <th class="py-2 pr-4">Description</th>
            <th class="py-2 pr-4">Submitted</th>
          </tr>
        </thead>
        <tbody>
          {% for l in logs %}
            <tr class="border-b align-top">
              <td class="py-2 pr-4 whitespace-nowrap">{{ l.name }}</td>
              <td class="py-2 pr-4 whitespace-nowrap">{{ l.work_date.strftime('%Y-%m-%d') }}</td>
              <td class="py-2 pr-4 whitespace-nowrap">{{ '%.2f'|format(l.hours) }}</td>
              <td class="py-2 pr-4">{{ l.description }}</td>
              <td class="py-2 pr-4 whitespace-nowrap text-slate-500">{{ l.created_at.strftime('%Y-%m-%d %H:%M') }} UTC</td>
            </tr>
          {% else %}
            <tr><td class="py-6 text-slate-500" colspan="5">No logs yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-4 text-right text-sm">
      <span class="font-semibold">Total hours:</span> {{ '%.2f'|format(total_hours) }}
    </div>
  </div>

  <script>
    // Build export URL from current filters
    const exportBtn = document.getElementById('exportBtn');
    const params = new URLSearchParams(window.location.search);
    exportBtn.href = '/export' + (params.toString() ? ('?' + params.toString()) : '');
  </script>
{% endblock %}